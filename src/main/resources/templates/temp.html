<!DOCTYPE HTML>
<html xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml" layout:decorate="~{layout}" lang="en">

<head>
  <th:block layout:fragment="metadata" th:remove="tag">
    <title>Blog Template</title>
  </th:block>
</head>

<body>
<div layout:fragment="content" th:remove="tag">
  <div id="toc" class="toc-full" style="top:60px;left:97%;position:fixed;z-index:5;" onmouseenter="toggleTOC();" onmouseleave="toggleTOC()">
    <div id="toc-dropdown" class="toc toc-dropdown">
      <div style="display: block;position: absolute;top: 50%;transform: translateY(-50%);margin: 0;width: 100%;">
        <
      </div>
    </div>
    <div style="display:inline;" class="toc toc-list">
      <ul class="dashed" style="padding-left: 0rem;">
        <li><a href="#title">Title</a></li>
        <li><a href="#gallery">Gallery</a></li>
        <li><a href="#comment-section">Comment Section</a></li>
      </ul>
    </div>
  </div>

  <div id="votes" class="sub-window" style="float:left;margin-top:10px;border-radius: 20px;background-color: transparent !important;">
    <div style="width:30px;">
      <p id="score" th:text="${score}" style="margin-bottom: 0px;text-align: center;"></p>
        <button id="upvote" type="button" class="vote-btn upvote" onclick="toggleUp();">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-circle" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-7.5 3.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z"></path>
          </svg>
          <span class="visually-hidden">Button</span>
        </button>
        <button id="downvote" type="button" class="vote-btn dnvote" onclick="toggleDown();">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down-circle" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"></path>
          </svg>
          <span class="visually-hidden">Button</span>
        </button>
    </div>
  </div>

  <main class="container">
    <div class="body-window articles" style="margin:10px 0; padding:30px;">

      <h1 id="title" class="text-center font-monospace">
        Welcome to Username's Blog
      </h1>
      <div style="padding:10px;">

        <div class="sub-window">
          <h5>Here is where information about the user would go</h5>
        </div>

      </div>
    </div>
    <div class="body-window articles" style="margin: 10px 0;">
      <div style="padding:30px;">
        <h3 id="gallery" class="text-center font-monospace">Gallery</h3>

        <div class="modal fade" id="addImage" tabindex="-1" aria-labelledby="addImage" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form action="/temp/imagePost" method="POST" id="addImageForm">
                  <div class="form-group">
                    <label for="imageURL" class="col-form-label">Image URL:</label>
                    <input id="imageURL" type="text" class="form-control" name="imageURL">
                </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary" value="Submit" onclick="postImage()">Add Image</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addImage">+</button>
        <div style="display:inline;grid-template-columns: 2;" id="image-container">

          <div th:each="image, index : ${images}">
            <img style="max-width: 50%;" th:src="${image}" alt="${index}">
          </div>

        </div>
      </div>
    </div>

    <div class="body-window articles" style="margin:10px 0; padding:30px;">

      <h3 id="comment-section" class="text-center font-monospace">Comment Section</h3>
      <div th:each="Comment: ${Comments}">

        <div style="padding:10px;">
          <div class="sub-window">
            <div>
              <h4 style="display:inline"><u th:text="${Comment.key[0]}"></u></h4><p style="display:inline" th:text="'  ' + ${Comment.key[1]}"></p>
            </div>
            <p style="margin-left: 20px;" th:text="${Comment.value}"></p>
          </div>
        </div>

      </div><br>
      <form action="/temp" method="POST" id="commentSubmit">
        <input class="form-control sub-window" style="border:none" name="name" id="Author" placeholder="Username (Optional)"><br>
        <textarea class="form-control sub-window" style="border:none" name="content" id="commentForm" placeholder="Contents"></textarea><br>
        <button class="btn btn-light">Submit</button>
      </form>
    </div>
  </main>
  <script>
    var toc = document.getElementById("toc");
    var tocDropdownText = document.getElementById("toc-dropdown");
    var upvote = document.getElementById("upvote");
    var downvote = document.getElementById("downvote");
    var score = document.getElementById("score");
    var imageContainer = document.getElementById("image-container");
    var imageTemplate = document.getElementById("image-template");

    if (localStorage.getItem("voteStatus") === "up") {upvote.classList.toggle("orange-btn");}
    if (localStorage.getItem("voteStatus") === "down") {downvote.classList.toggle("blue-btn");}

    function toggleTOC() {
      toc.classList.toggle("toc-show");
      tocDropdownText.classList.toggle("toc-dropdown-rotate");
    }
    function toggleUp() {
      if (upvote.classList.contains("orange-btn")) {
        upvote.classList.toggle("orange-btn");
        voteDn();
        localStorage.setItem("voteStatus", "none");
      } else {
        upvote.classList.toggle("orange-btn");
        voteUp();
        localStorage.setItem("voteStatus", "up");
      }
      if (downvote.classList.contains("blue-btn")) {
        downvote.classList.toggle("blue-btn");
        voteUp();
      }
    }

    function toggleDown() {
      if (downvote.classList.contains("blue-btn")) {
        downvote.classList.toggle("blue-btn");
        voteUp();
        localStorage.setItem("voteStatus", "none");
      } else {
        downvote.classList.toggle("blue-btn");
        voteDn();
        localStorage.setItem("voteStatus", "down");
      }
      if (upvote.classList.contains("orange-btn")) {
        upvote.classList.toggle("orange-btn");
        voteDn();
      }
    }

    async function voteUp() {
      score.innerText++;
      let data = await (await fetch('/temp/voteUp', {
        method: 'POST',
        body: null
      })).text();
    }
    async function voteDn() {
      score.innerText--;
      let data = await (await fetch('/temp/voteDn', {
        method: 'POST',
        body: null
      })).text();
    }

    async function postImage() {
      var imageURL = document.getElementById("imageURL").value;
      var imageDiv = document.createElement("div");
      var imageImg = document.createElement("img");
      imageImg.setAttribute("src", imageURL);
      imageImg.setAttribute("style", "max-width: 50%;");
      imageDiv.appendChild(imageImg);
      imageContainer.appendChild(imageDiv);

      let form = document.getElementById("addImageForm");
      let data = await (await fetch('/temp/imagePost', {
          method: 'POST',
          body: new FormData(form)
      })).text();
}
  </script>
</div>
</body>

</html>